<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2DOF ë¡œë´‡ íŒ” ì—­ê¸°êµ¬í•™ - ìì½”ë¹„ì•ˆ ë°©ë²•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 15px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9em;
        }
        
        input[type="range"] {
            width: 200px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        canvas {
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            background: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-box {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }
        
        .info-box h3 {
            margin: 0 0 15px 0;
            color: #4a5568;
            font-size: 1.2em;
        }
        
        .value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #667eea;
        }
        
        .iteration-info {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            color: #742a2a;
        }
        
        .converged {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #276749;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦¾ 2DOF ë¡œë´‡ íŒ” ì—­ê¸°êµ¬í•™</h1>
        <p style="text-align: center; font-size: 1.1em; color: #666; margin-bottom: 30px;">
            ìì½”ë¹„ì•ˆ ì—­í–‰ë ¬ì„ ì´ìš©í•œ ìˆ˜ì¹˜í•´ì„ ë°©ë²•ìœ¼ë¡œ ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í•˜ëŠ” ê³¼ì •ì„ ì‹œê°í™”í•©ë‹ˆë‹¤
        </p>
        
        <div class="controls">
            <div class="control-group">
                <label>ëª©í‘œ X ì¢Œí‘œ: <span class="value" id="targetXValue">200</span></label>
                <input type="range" id="targetX" min="50" max="350" value="200">
            </div>
            <div class="control-group">
                <label>ëª©í‘œ Y ì¢Œí‘œ: <span class="value" id="targetYValue">200</span></label>
                <input type="range" id="targetY" min="50" max="350" value="200">
            </div>
            <div class="control-group">
                <label>ë§í¬1 ê¸¸ì´: <span class="value" id="l1Value">100</span></label>
                <input type="range" id="l1" min="50" max="150" value="100">
            </div>
            <div class="control-group">
                <label>ë§í¬2 ê¸¸ì´: <span class="value" id="l2Value">80</span></label>
                <input type="range" id="l2" min="50" max="150" value="80">
            </div>
            <div class="control-group">
                <button onclick="solveInverseKinematics()">ì—­ê¸°êµ¬í•™ í•´ê²°</button>
                <button onclick="resetRobot()">ì´ˆê¸°í™”</button>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="robotCanvas" width="600" height="400"></canvas>
        </div>
        
        <div class="info-panel">
            <div class="info-box">
                <h3>ğŸ“ í˜„ì¬ ê´€ì ˆ ê°ë„</h3>
                <div>Î¸1: <span class="value" id="theta1Display">45.0Â°</span></div>
                <div>Î¸2: <span class="value" id="theta2Display">45.0Â°</span></div>
            </div>
            
            <div class="info-box">
                <h3>ğŸ“ í˜„ì¬ ìœ„ì¹˜</h3>
                <div>X: <span class="value" id="currentXDisplay">0</span></div>
                <div>Y: <span class="value" id="currentYDisplay">0</span></div>
            </div>
            
            <div class="info-box">
                <h3>ğŸ¯ ëª©í‘œ ìœ„ì¹˜</h3>
                <div>X: <span class="value" id="targetXDisplay">200</span></div>
                <div>Y: <span class="value" id="targetYDisplay">200</span></div>
            </div>
            
            <div class="info-box" id="iterationBox">
                <h3>ğŸ”„ ë°˜ë³µ ì •ë³´</h3>
                <div>ë°˜ë³µ íšŸìˆ˜: <span class="value" id="iterationCount">0</span></div>
                <div>ì˜¤ì°¨: <span class="value" id="errorDisplay">0.0</span></div>
                <div>ìƒíƒœ: <span class="value" id="statusDisplay">ëŒ€ê¸° ì¤‘</span></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('robotCanvas');
        const ctx = canvas.getContext('2d');
        
        // ë¡œë´‡ íŒŒë¼ë¯¸í„°
        let theta1 = Math.PI/4; // 45ë„
        let theta2 = Math.PI/4; // 45ë„
        let l1 = 100;
        let l2 = 80;
        let targetX = 200;
        let targetY = 200;
        
        // ì›ì  (ìº”ë²„ìŠ¤ ì¤‘ì‹¬ í•˜ë‹¨)
        const originX = canvas.width / 2;
        const originY = canvas.height - 50;
        
        // ìˆ˜ì¹˜ í•´ì„ íŒŒë¼ë¯¸í„°
        const maxIterations = 100;
        const tolerance = 1.0;
        const learningRate = 0.5;
        
        function updateSliderValues() {
            document.getElementById('targetXValue').textContent = document.getElementById('targetX').value;
            document.getElementById('targetYValue').textContent = document.getElementById('targetY').value;
            document.getElementById('l1Value').textContent = document.getElementById('l1').value;
            document.getElementById('l2Value').textContent = document.getElementById('l2').value;
        }
        
        // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('targetX').addEventListener('input', function() {
            targetX = parseInt(this.value);
            updateSliderValues();
            updateDisplay();
            draw();
        });
        
        document.getElementById('targetY').addEventListener('input', function() {
            targetY = parseInt(this.value);
            updateSliderValues();
            updateDisplay();
            draw();
        });
        
        document.getElementById('l1').addEventListener('input', function() {
            l1 = parseInt(this.value);
            updateSliderValues();
            updateDisplay();
            draw();
        });
        
        document.getElementById('l2').addEventListener('input', function() {
            l2 = parseInt(this.value);
            updateSliderValues();
            updateDisplay();
            draw();
        });
        
        // ìˆœê¸°êµ¬í•™: ê´€ì ˆ ê°ë„ â†’ ëì  ìœ„ì¹˜
        function forwardKinematics(th1, th2) {
            const x1 = l1 * Math.cos(th1);
            const y1 = l1 * Math.sin(th1);
            const x2 = x1 + l2 * Math.cos(th1 + th2);
            const y2 = y1 + l2 * Math.sin(th1 + th2);
            
            return {
                joint1: { x: x1, y: y1 },
                endEffector: { x: x2, y: y2 }
            };
        }
        
        // ìì½”ë¹„ì•ˆ í–‰ë ¬ ê³„ì‚°
        function calculateJacobian(th1, th2) {
            const j11 = -l1 * Math.sin(th1) - l2 * Math.sin(th1 + th2);
            const j12 = -l2 * Math.sin(th1 + th2);
            const j21 = l1 * Math.cos(th1) + l2 * Math.cos(th1 + th2);
            const j22 = l2 * Math.cos(th1 + th2);
            
            return [[j11, j12], [j21, j22]];
        }
        
        // 2x2 í–‰ë ¬ì˜ ì—­í–‰ë ¬ ê³„ì‚°
        function inverseMatrix2x2(matrix) {
            const [[a, b], [c, d]] = matrix;
            const det = a * d - b * c;
            
            if (Math.abs(det) < 1e-6) {
                // íŠ¹ì´ì  ê·¼ì²˜ì—ì„œëŠ” ì˜ì‚¬ì—­í–‰ë ¬ ì‚¬ìš©
                return [[0, 0], [0, 0]];
            }
            
            return [[d/det, -b/det], [-c/det, a/det]];
        }
        
        // ì—­ê¸°êµ¬í•™ í•´ê²° (ìì½”ë¹„ì•ˆ ê¸°ë°˜)
        function solveInverseKinematics() {
            let currentTheta1 = theta1;
            let currentTheta2 = theta2;
            let iteration = 0;
            let error = Infinity;
            
            const iterationBox = document.getElementById('iterationBox');
            iterationBox.className = 'info-box iteration-info';
            
            function iterate() {
                if (iteration >= maxIterations || error < tolerance) {
                    // ìˆ˜ë ´ ì™„ë£Œ
                    theta1 = currentTheta1;
                    theta2 = currentTheta2;
                    
                    if (error < tolerance) {
                        iterationBox.className = 'info-box converged';
                        document.getElementById('statusDisplay').textContent = 'ìˆ˜ë ´ ì™„ë£Œ!';
                    } else {
                        document.getElementById('statusDisplay').textContent = 'ìµœëŒ€ ë°˜ë³µ ë„ë‹¬';
                    }
                    
                    updateDisplay();
                    draw();
                    return;
                }
                
                // í˜„ì¬ ìœ„ì¹˜ ê³„ì‚°
                const currentPos = forwardKinematics(currentTheta1, currentTheta2);
                const currentX = currentPos.endEffector.x;
                const currentY = currentPos.endEffector.y;
                
                // ì˜¤ì°¨ ê³„ì‚°
                const errorX = targetX - currentX;
                const errorY = targetY - currentY;
                error = Math.sqrt(errorX * errorX + errorY * errorY);
                
                // ìì½”ë¹„ì•ˆ ê³„ì‚°
                const jacobian = calculateJacobian(currentTheta1, currentTheta2);
                const jacobianInv = inverseMatrix2x2(jacobian);
                
                // ê°ë„ ì—…ë°ì´íŠ¸
                const deltaTheta1 = learningRate * (jacobianInv[0][0] * errorX + jacobianInv[0][1] * errorY);
                const deltaTheta2 = learningRate * (jacobianInv[1][0] * errorX + jacobianInv[1][1] * errorY);
                
                currentTheta1 += deltaTheta1;
                currentTheta2 += deltaTheta2;
                
                // ê°ë„ ì •ê·œí™” (-Ï€ ~ Ï€)
                currentTheta1 = ((currentTheta1 + Math.PI) % (2 * Math.PI)) - Math.PI;
                currentTheta2 = ((currentTheta2 + Math.PI) % (2 * Math.PI)) - Math.PI;
                
                iteration++;
                
                // ì„ì‹œë¡œ ê°ë„ ì—…ë°ì´íŠ¸í•˜ì—¬ ì‹œê°í™”
                theta1 = currentTheta1;
                theta2 = currentTheta2;
                
                // ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('iterationCount').textContent = iteration;
                document.getElementById('errorDisplay').textContent = error.toFixed(2);
                document.getElementById('statusDisplay').textContent = 'ê³„ì‚° ì¤‘...';
                
                updateDisplay();
                draw();
                
                // ë‹¤ìŒ ë°˜ë³µì„ ìœ„í•œ íƒ€ì´ë¨¸ ì„¤ì •
                setTimeout(iterate, 100);
            }
            
            iterate();
        }
        
        function resetRobot() {
            theta1 = Math.PI/4;
            theta2 = Math.PI/4;
            
            const iterationBox = document.getElementById('iterationBox');
            iterationBox.className = 'info-box';
            
            document.getElementById('iterationCount').textContent = '0';
            document.getElementById('errorDisplay').textContent = '0.0';
            document.getElementById('statusDisplay').textContent = 'ì´ˆê¸°í™”ë¨';
            
            updateDisplay();
            draw();
        }
        
        function updateDisplay() {
            const pos = forwardKinematics(theta1, theta2);
            
            document.getElementById('theta1Display').textContent = (theta1 * 180 / Math.PI).toFixed(1) + 'Â°';
            document.getElementById('theta2Display').textContent = (theta2 * 180 / Math.PI).toFixed(1) + 'Â°';
            document.getElementById('currentXDisplay').textContent = pos.endEffector.x.toFixed(1);
            document.getElementById('currentYDisplay').textContent = pos.endEffector.y.toFixed(1);
            document.getElementById('targetXDisplay').textContent = targetX;
            document.getElementById('targetYDisplay').textContent = targetY;
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ê²©ì ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i <= canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // ë¡œë´‡ ìœ„ì¹˜ ê³„ì‚°
            const pos = forwardKinematics(theta1, theta2);
            const joint1X = originX + pos.joint1.x;
            const joint1Y = originY - pos.joint1.y;
            const endX = originX + pos.endEffector.x;
            const endY = originY - pos.endEffector.y;
            
            // ë¡œë´‡ íŒ” ê·¸ë¦¬ê¸°
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            
            // ì²« ë²ˆì§¸ ë§í¬
            ctx.strokeStyle = '#667eea';
            ctx.beginPath();
            ctx.moveTo(originX, originY);
            ctx.lineTo(joint1X, joint1Y);
            ctx.stroke();
            
            // ë‘ ë²ˆì§¸ ë§í¬
            ctx.strokeStyle = '#764ba2';
            ctx.beginPath();
            ctx.moveTo(joint1X, joint1Y);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            
            // ê´€ì ˆ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            ctx.arc(originX, originY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(joint1X, joint1Y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // ëì  ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#e53e3e';
            ctx.beginPath();
            ctx.arc(endX, endY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ëª©í‘œ ìœ„ì¹˜ ê·¸ë¦¬ê¸°
            const targetCanvasX = originX + targetX;
            const targetCanvasY = originY - targetY;
            
            ctx.strokeStyle = '#38a169';
            ctx.fillStyle = 'rgba(56, 161, 105, 0.3)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(targetCanvasX, targetCanvasY, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // ì‹­ì í‘œì‹œ
            ctx.strokeStyle = '#38a169';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(targetCanvasX - 10, targetCanvasY);
            ctx.lineTo(targetCanvasX + 10, targetCanvasY);
            ctx.moveTo(targetCanvasX, targetCanvasY - 10);
            ctx.lineTo(targetCanvasX, targetCanvasY + 10);
            ctx.stroke();
            
            // ê±°ë¦¬ ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = 'rgba(231, 62, 62, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(targetCanvasX, targetCanvasY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ë²”ë¡€
            ctx.fillStyle = '#4a5568';
            ctx.font = '14px Arial';
            ctx.fillText('ğŸ”´ í˜„ì¬ ìœ„ì¹˜', 20, 30);
            ctx.fillText('ğŸ¯ ëª©í‘œ ìœ„ì¹˜', 20, 50);
            ctx.fillText('ğŸ“ ì˜¤ì°¨ ê±°ë¦¬', 20, 70);
        }
        
        // ì´ˆê¸°í™”
        updateSliderValues();
        updateDisplay();
        draw();
    </script>
</body>
</html>